<?php 

================================================================================
                    NATAN-PHP FRAMEWORK - PROMPT COMPLETO V2
================================================================================

PROMPT PARA EJECUTAR EN OTRO EQUIPO
CONVERSACI√ìN COMPLETA DEL PROYECTO
FECHA: 28 de octubre de 2025
VERSI√ìN: 2.0 - Estructura Simple e Innovadora

================================================================================
                            INSTRUCCIONES DE USO
================================================================================

Copia este prompt completo y p√©galo en tu nuevo equipo para continuar el proyecto.
El asistente implementar√° todo el framework basado en estas especificaciones.

================================================================================
                            PROMPT COMPLETO V2
================================================================================

Hola, necesito tu ayuda para crear un framework PHP MVC completo desde cero llamado **NATAN-PHP**. 
Este es un proyecto educativo para un curso. Aqu√≠ est√°n todas las especificaciones y requerimientos 
que hemos definido con una estructura moderna, simple pero innovadora:

## CONTEXTO DEL PROYECTO

Estoy creando un curso de c√≥mo desarrollar un framework PHP MVC desde cero. El framework debe ser 
educativo, pero funcional y completo. Se llama **NatanPHP** y debe diferenciarse de Laravel 
con una estructura m√°s simple y clara.

## ESTRUCTURA INNOVADORA SIMPLIFICADA

### Filosof√≠a: "Simplicidad con Prop√≥sito"

A diferencia de Laravel que mezcla todo en `app/`, NatanPHP separa claramente por **funci√≥n** 
pero de manera **simple**:

```
natan-php/
‚îú‚îÄ‚îÄ üß† core/                    # El cerebro del framework (como Laravel Core)
‚îÇ   ‚îú‚îÄ‚îÄ Router.php              # Sistema de rutas
‚îÇ   ‚îú‚îÄ‚îÄ Database.php            # Conexi√≥n y ORM
‚îÇ   ‚îú‚îÄ‚îÄ View.php                # Motor de plantillas
‚îÇ   ‚îú‚îÄ‚îÄ Request.php             # Manejo de requests
‚îÇ   ‚îî‚îÄ‚îÄ Console.php             # Sistema de comandos
‚îú‚îÄ‚îÄ üè† app/                     # Tu aplicaci√≥n (como Laravel pero organizado)
‚îÇ   ‚îú‚îÄ‚îÄ Web/                    # TODO lo relacionado con WEB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/        # Controladores web
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Views/              # Vistas y plantillas
‚îÇ   ‚îú‚îÄ‚îÄ Api/                    # TODO lo relacionado con API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/        # Controladores API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Resources/          # Transformadores JSON
‚îÇ   ‚îú‚îÄ‚îÄ Shared/                 # Compartido entre Web y API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Models/             # Modelos de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Services/           # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Middleware/         # Middleware compartido
‚îÇ   ‚îî‚îÄ‚îÄ Database/               # Base de datos
‚îÇ       ‚îú‚îÄ‚îÄ migrations/         # Migraciones
‚îÇ       ‚îî‚îÄ‚îÄ seeds/              # Datos de prueba
‚îú‚îÄ‚îÄ üìÅ public/                  # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ index.php               # Bootstrap
‚îÇ   ‚îî‚îÄ‚îÄ assets/                 # CSS, JS, im√°genes
‚îú‚îÄ‚îÄ üõ£Ô∏è routes/                  # Rutas separadas y claras
‚îÇ   ‚îú‚îÄ‚îÄ web.php                 # Rutas web
‚îÇ   ‚îî‚îÄ‚îÄ api.php                 # Rutas API
‚îú‚îÄ‚îÄ ‚öôÔ∏è config/                  # Configuraci√≥n simple
‚îÇ   ‚îú‚îÄ‚îÄ app.php                 # App principal
‚îÇ   ‚îú‚îÄ‚îÄ database.php            # Base de datos
‚îÇ   ‚îî‚îÄ‚îÄ cache.php               # Cach√©
‚îú‚îÄ‚îÄ üì¶ storage/                 # Almacenamiento
‚îÇ   ‚îú‚îÄ‚îÄ cache/                  # Cache de vistas y datos
‚îÇ   ‚îú‚îÄ‚îÄ logs/                   # Logs del sistema
‚îÇ   ‚îî‚îÄ‚îÄ uploads/                # Archivos subidos
‚îú‚îÄ‚îÄ natan                       # Comando CLI (ejecutable)
‚îú‚îÄ‚îÄ composer.json               # Dependencias
‚îú‚îÄ‚îÄ .env.example                # Variables de entorno
‚îî‚îÄ‚îÄ README.md                   # Documentaci√≥n
```

## DIFERENCIAS CLAVE CON LARAVEL

### 1. **Separaci√≥n Web/Api clara**
```bash
# Laravel: Todo mezclado en app/
app/Http/Controllers/UserController.php     # ¬øWeb o API? ü§î

# NatanPHP: Separaci√≥n clara
app/Web/Controllers/UserController.php      # Definitivamente WEB üåê
app/Api/Controllers/UserController.php      # Definitivamente API üöÄ
```

### 2. **Core m√°s simple y educativo**
```bash
# Laravel: Carpetas complicadas
vendor/laravel/framework/src/Illuminate/...  # Muy complejo

# NatanPHP: Core directo y educativo
core/Router.php                              # ¬°Puedes leer el c√≥digo!
core/Database.php                            # ¬°Entiendes c√≥mo funciona!
```

### 3. **Comando personalizado "natan"**
```bash
# Laravel
php artisan make:controller UserController

# NatanPHP  
php natan create controller User             # M√°s natural
php natan create model User --web           # Especifica si es web
php natan create crud Product --api         # O si es API
```

## CARACTER√çSTICAS PRINCIPALES REQUERIDAS

### 1. ARQUITECTURA MVC
- Sistema de rutas din√°micas con par√°metros (ej: /producto/{id}, /usuario/{nombre})
- Controladores separados para Web y API
- Modelos con ORM personalizado (Active Record pattern)
- Vistas con motor de plantillas personalizado

### 2. SISTEMA DE RUTAS
- Sintaxis similar a Laravel: $router->get('/productos', 'ProductController@index')
- Soporte para par√°metros din√°micos: /producto/{id}, /usuario/{nombre}/perfil
- Rutas agrupadas con prefijos y middleware
- M√©todo resource() para CRUD autom√°tico
- Archivos separados: routes/web.php y routes/api.php

### 3. MOTOR DE PLANTILLAS PERSONALIZADO
- Sintaxis tipo Blade de Laravel (no usar Twig ni Plates)
- Variables: {{ $variable }} con escape autom√°tico
- Variables sin escape: {!! $html !!}
- Estructuras de control: @if, @foreach, @while, @for
- Herencia de layouts: @extends, @section, @yield
- Inclusiones: @include
- Helpers: @isset, @empty, @auth, @guest
- Push/stack: @push, @stack
- Helpers de vistas: @asset, @url, @csrf, @method

### 4. ORM COMPLETO
- Active Record pattern como Laravel
- Sintaxis: User::find(1), User::where('active', 1)->get()
- M√©todos: create(), save(), delete(), update()
- Relaciones: hasMany(), belongsTo(), belongsToMany()
- Query Builder con joins, where, orderBy, limit
- Paginaci√≥n: Model::paginate(10) exacto como Laravel
- Mass assignment con fillable/guarded
- Timestamps autom√°ticos
- Mutators y Accessors

### 5. SISTEMA DE COMANDOS CLI "NATAN"
- Nombre del comando: "natan" (NO artisan como Laravel, NO maker)
- Comandos requeridos:
  * php natan create controller ProductController --web
  * php natan create controller ProductController --api
  * php natan create model Product (crea autom√°ticamente migraci√≥n base)
  * php natan create migration create_products_table
  * php natan field add Product (asistente interactivo para agregar campos)
  * php natan field modify Product email (modificar campo existente)
  * php natan field drop Product age (eliminar campo)
  * php natan table describe Product (ver estructura de tabla)
  * php natan migrate (ejecutar migraciones)
  * php natan migrate:rollback (revertir migraci√≥n)
  * php natan create crud Product --web (genera controlador web, modelo y vistas)
  * php natan create crud Product --api (genera controlador API con endpoints JSON)
  * php natan create crud Product --full (genera web + API)
  * php natan create crud Product --interactive (asistente completo interactivo)

=== COMANDOS DE CONFIGURACI√ìN DE PROYECTO ===

  * php natan project mode web (configura proyecto solo para web)
  * php natan project mode api (configura proyecto solo para API)
  * php natan project mode full (proyecto completo web + API)
  * php natan project optimize (limpia archivos no utilizados)
  * php natan routes list
  * php natan serve

### 6. SISTEMA DE MIGRACIONES INTERACTIVO
- Migraci√≥n autom√°tica al crear modelo: php natan create model User (crea migraci√≥n base)
- Asistente interactivo de campos: php natan field add User
  * Pregunta tipo de campo (string, text, integer, decimal, boolean, etc.)
  * Pregunta longitud, si puede ser NULL, si es √∫nico, si tiene √≠ndice
  * Pregunta valor por defecto
  * Genera Schema Builder autom√°ticamente (NO SQL crudo)
  * Actualiza autom√°ticamente migraci√≥n y modelo (fillable)
- Modificaci√≥n de campos: php natan field modify User email
- Eliminaci√≥n de campos: php natan field drop User age
- Visualizaci√≥n de estructura: php natan table describe User
- Detecci√≥n autom√°tica de relaciones (foreign_id genera m√©todos en modelo)
- Sugerencias inteligentes (email sugiere √∫nico e √≠ndice)
- Schema Builder como Laravel: $table->string('name')->unique()->nullable()
- Cross-database: Mismo c√≥digo funciona en MySQL, PostgreSQL, SQLite
- Tipos soportados: id(), string(), text(), integer(), decimal(), boolean(), date(), timestamp(), json(), enum(), foreignId()

### 7. FUNCIONALIDADES ADICIONALES
- Variables de entorno con archivo .env
- Sistema de cach√© b√°sico
- Helpers globales (asset(), url(), old(), csrf_token(), etc.)
- P√°gina de bienvenida autom√°tica en la ruta /
- Sistema de validaci√≥n b√°sico
- Manejo de errores
- Middleware b√°sico
- Autoloading PSR-4

## ESPECIFICACIONES T√âCNICAS

### Tecnolog√≠as:
- PHP 8.0+
- Composer para autoloading
- PDO para base de datos
- Motor de plantillas propio (no librer√≠as externas)
- Variables de entorno con vlucas/phpdotenv

## EJEMPLOS DE FLUJO INTERACTIVO

### Crear modelo con migraci√≥n:
```bash
php natan create model User
```

### Agregar campos interactivamente:
```bash
php natan field add User

# Flujo interactivo:
Campo #1:
Nombre del campo: name
Tipo: 1 (string)
Longitud [255]: 255
¬øPuede ser NULL? [y/N]: N

Campo #2:
Nombre del campo: email  
Tipo: 1 (string)
Longitud [255]: 255
¬øPuede ser NULL? [y/N]: N
¬øEs √∫nico? [y/N]: y

Campo #3:
Nombre del campo: age
Tipo: 3 (integer)
¬øPuede ser NULL? [y/N]: y
¬øValor por defecto? [y/N]: y
Valor: 0

‚úÖ Migraci√≥n actualizada autom√°ticamente
‚úÖ Modelo actualizado (fillable fields)
```

### Ver estructura:
```bash
php natan table describe User

| Campo      | Tipo         | NULL | Clave | Default |
|------------|--------------|------|-------|---------|
| id         | INT          | NO   | PRI   | AI      |
| name       | VARCHAR(255) | NO   |       |         |
| email      | VARCHAR(255) | NO   | UNI   |         |
| age        | INT          | YES  |       | 0       |
| created_at | TIMESTAMP    | NO   |       | CURRENT |
| updated_at | TIMESTAMP    | NO   |       | CURRENT |
```

### Mapeo autom√°tico de modelos:
```php
// app/Shared/Models/User.php (generado autom√°ticamente)
class User extends Model {
    protected $table = 'users'; // Autom√°tico: User -> users
    protected $fillable = ['name', 'email', 'age']; // Auto-generado
    
    // Si se detecta category_id, se genera autom√°ticamente:
    public function category() {
        return $this->belongsTo(Category::class);
    }
}
```

### Rutas Web (routes/web.php):
```php
$router->get('/', 'WelcomeController@index');
$router->get('/productos', 'ProductController@index');
$router->get('/producto/{id}', 'ProductController@show');
$router->resource('/products', 'ProductController');
```

### Rutas API (routes/api.php):
```php
$router->get('/products', 'ProductController@index');
$router->get('/products/{id}', 'ProductController@show');
$router->post('/products', 'ProductController@store');
$router->put('/products/{id}', 'ProductController@update');
$router->delete('/products/{id}', 'ProductController@destroy');
```

### Controlador Web:
```php
// app/Web/Controllers/ProductController.php
class ProductController extends Controller {
    public function index() {
        $products = Product::paginate(10);
        return $this->view('products.index', compact('products'));
    }
}
```

### Controlador API:
```php
// app/Api/Controllers/ProductController.php
class ProductController extends ApiController {
    public function index() {
        $products = Product::paginate(10);
        return $this->jsonResponse($products);
    }
}
```

### Modelo:
```php
// app/Shared/Models/Product.php
class Product extends Model {
    protected $fillable = ['name', 'price', 'description'];
    
    public function category() {
        return $this->belongsTo(Category::class);
    }
}
```

### Vista Web (app/Web/Views/products/index.natan.php):
```php
@extends('layouts.app')

@section('content')
<h1>Productos</h1>
@foreach($products->items() as $product)
    <div>{{ $product->name }} - ${{ $product->price }}</div>
@endforeach
{{ $products->links() }}
@endsection
```

### Comandos principales:
```bash
php natan create crud Product --web      # Solo funcionalidad web
php natan create crud Product --api      # Solo funcionalidad API
php natan create crud Product --full     # Web + API
php natan create controller UserController --web  
php natan create model User
php natan field add User --interactive
```

## CARACTER√çSTICAS ESPECIALES

1. **Separaci√≥n Clara Web/API**: Controladores y vistas organizados por funci√≥n
2. **Paginaci√≥n como Laravel**: Product::paginate(10) con links() en vistas
3. **Motor de plantillas compilado**: Cache de vistas compiladas
4. **Helpers globales**: Disponibles en PHP y vistas
5. **CRUD autom√°tico**: Un comando genera controlador + modelo + vistas seg√∫n tipo
6. **P√°gina de bienvenida**: Al instalar muestra info del framework
7. **URLs amigables**: Con .htaccess autom√°tico
8. **Core educativo**: C√≥digo del framework visible y comprensible

## PROGRESI√ìN DEL DESARROLLO

Implementar en este orden:
1. Estructura b√°sica y autoloading con nueva organizaci√≥n
2. Sistema de rutas con par√°metros
3. Controladores base para Web y API
4. Motor de plantillas personalizado
5. Conexi√≥n a base de datos
6. ORM con Active Record
7. Query Builder y relaciones
8. Sistema de paginaci√≥n
9. Comandos CLI (natan)
10. Helpers y utilidades
11. Sistema de cach√©
12. Archivos de ejemplo

## OBJETIVOS EDUCATIVOS

- Ense√±ar c√≥mo funcionan los frameworks internamente
- Mostrar patrones de dise√±o (Active Record, MVC, Factory)
- Explicar autoloading, namespaces y PSR-4
- Demostrar compilaci√≥n de plantillas
- Ense√±ar construcci√≥n de query builders
- Mostrar implementaci√≥n de paginaci√≥n
- Ense√±ar separaci√≥n clara de responsabilidades (Web vs API)

## DIFERENCIACI√ìN

- Estructura m√°s simple y clara que Laravel
- Separaci√≥n expl√≠cita Web/API desde el inicio
- Motor de plantillas propio (no Twig/Plates)
- Comando "natan" (no artisan)
- Core educativo y visible
- Enfoque educativo y explicativo
- C√≥digo limpio y comentado
- Progresi√≥n incremental

================================================================================
                        SISTEMA DE COMANDOS NATAN
================================================================================

El sistema de comandos incluye:

### Comandos de Creaci√≥n:
- php natan create controller ProductController --web
- php natan create controller ProductController --api  
- php natan create model Product
- php natan create migration create_products_table
- php natan create crud Product --web
- php natan create crud Product --api
- php natan create crud Product --full

### Comandos de Base de Datos:
- php natan field add Product
- php natan field modify Product email
- php natan field drop Product age
- php natan table describe Product
- php natan migrate
- php natan migrate:rollback

### Comandos de Proyecto:
- php natan project mode web
- php natan project mode api
- php natan project mode full
- php natan project optimize

### Comandos de Utilidad:
- php natan routes list
- php natan serve
- php natan install

================================================================================
                        MOTOR DE PLANTILLAS PERSONALIZADO
================================================================================

Sintaxis soportada (igual que versi√≥n anterior):

Variables:
{{ $variable }}           // Con escape autom√°tico
{!! $html !!}            // Sin escape

Estructuras de control:
@if($condicion)
    <p>Contenido</p>
@elseif($otra)
    <p>Otra condici√≥n</p>
@else
    <p>Por defecto</p>
@endif

Loops:
@foreach($items as $item)
    <div>{{ $item->nombre }}</div>
@endforeach

Herencia:
@extends('layouts.app')

@section('contenido')
    <h1>Contenido</h1>
@endsection

Helpers de vistas:
@asset('css/app.css')
@url('productos')
@csrf
@method('PUT')

================================================================================
                        ORM COMPLETO CON PAGINACI√ìN
================================================================================

Funcionalidades del ORM (igual que versi√≥n anterior):

=== Consultas B√°sicas ===
$users = User::all();
$user = User::find(1);
$users = User::where('active', 1)->get();

=== Creaci√≥n y Actualizaci√≥n ===
$user = User::create([
    'name' => 'Juan',
    'email' => 'juan@example.com'
]);

=== Relaciones ===
class User extends Model {
    public function posts() {
        return $this->hasMany(Post::class);
    }
}

=== Paginaci√≥n ===
$users = User::paginate(10);

// En la vista web
@foreach($users->items() as $user)
    <div>{{ $user->name }}</div>
@endforeach
{{ $users->links() }}

// En API
return $this->jsonResponse($users);

================================================================================
                            HELPERS GLOBALES
================================================================================

Los helpers incluyen (igual que versi√≥n anterior):

=== URL y Assets ===
asset('css/app.css')                    // /assets/css/app.css
url('productos')                        // /productos

=== Formularios ===
csrf_field()                            // Token CSRF
method_field('PUT')                     // Method spoofing

=== Utilidades ===
dd($variable)                           // Debug y salir
config('app.name')                      // Configuraci√≥n
env('APP_DEBUG')                        // Variable de entorno

================================================================================
                        INSTALACI√ìN Y CONFIGURACI√ìN
================================================================================

=== Instalaci√≥n paso a paso ===

1. Crear proyecto:
mkdir mi-proyecto-natan
cd mi-proyecto-natan

2. Inicializar:
php natan install

3. Configurar base de datos en .env

4. Crear primera migraci√≥n:
php natan create migration create_users_table

5. Crear primer modelo y controlador:
php natan create model User
php natan create controller UserController --web

6. Crear CRUD completo:
php natan create crud Product --full

7. Servidor de desarrollo:
php natan serve

================================================================================
                        EJEMPLOS DE USO CON NUEVA ESTRUCTURA
================================================================================

=== Crear un m√≥dulo web completo ===

1. Generar CRUD web:
php natan create crud Product --web

2. Esto crea:
- app/Shared/Models/Product.php
- app/Web/Controllers/ProductController.php
- app/Web/Views/products/index.natan.php
- app/Web/Views/products/show.natan.php
- app/Web/Views/products/create.natan.php
- app/Web/Views/products/edit.natan.php
- Rutas en routes/web.php

=== Crear un m√≥dulo API completo ===

1. Generar CRUD API:
php natan create crud Product --api

2. Esto crea:
- app/Shared/Models/Product.php (si no existe)
- app/Api/Controllers/ProductController.php
- app/Api/Resources/ProductResource.php
- Rutas en routes/api.php

=== Crear m√≥dulo completo (Web + API) ===

1. Generar CRUD completo:
php natan create crud Product --full

2. Esto crea AMBOS: todos los archivos web + todos los archivos API

================================================================================
                        CARACTER√çSTICAS AVANZADAS
================================================================================

=== Middleware compartido ===
// app/Shared/Middleware/AuthMiddleware.php
class AuthMiddleware {
    public function handle($request, $next) {
        if (!auth()) {
            return redirect('/login');
        }
        return $next($request);
    }
}

=== Servicios compartidos ===
// app/Shared/Services/ProductService.php
class ProductService {
    public function createProduct($data) {
        return Product::create($data);
    }
}

=== API Resources ===
// app/Api/Resources/ProductResource.php
class ProductResource {
    public function transform($product) {
        return [
            'id' => $product->id,
            'name' => $product->name,
            'price' => number_format($product->price, 2)
        ];
    }
}

================================================================================
                        CONFIGURACI√ìN DE PROYECTO
================================================================================

=== Modos de proyecto ===

**Modo Web Only:**
```bash
php natan project mode web
```
- Elimina carpeta app/Api/
- Elimina routes/api.php
- Optimiza para aplicaciones web tradicionales

**Modo API Only:**
```bash
php natan project mode api
```
- Elimina carpeta app/Web/
- Elimina routes/web.php
- Optimiza para APIs REST

**Modo Full:**
```bash
php natan project mode full
```
- Mantiene ambas carpetas
- Funcionalidad completa Web + API

================================================================================
                            CONCLUSI√ìN
================================================================================

**NatanPHP Framework V2** incluye todas las caracter√≠sticas modernas de un framework PHP con una estructura innovadora y simple:

‚úÖ **Arquitectura clara**: Separaci√≥n expl√≠cita Web/API
‚úÖ **Core educativo**: C√≥digo del framework visible y comprensible  
‚úÖ **MVC completo**: Con separaci√≥n de responsabilidades
‚úÖ **ORM con relaciones**: Active Record pattern
‚úÖ **Sistema de plantillas**: Motor propio tipo Blade
‚úÖ **Paginaci√≥n**: Como Laravel
‚úÖ **Comandos CLI**: Sistema "natan" intuitivo
‚úÖ **Routing din√°mico**: Con par√°metros y middleware
‚úÖ **Helpers √∫tiles**: Para desarrollo r√°pido
‚úÖ **Sistema de cach√©**: Para rendimiento
‚úÖ **Validaci√≥n**: Para seguridad
‚úÖ **Middleware**: Para funcionalidad transversal

**Diferenciadores clave de Laravel:**
- Estructura m√°s simple y clara
- Separaci√≥n expl√≠cita Web/API desde el dise√±o
- Core educativo y accesible
- Comando "natan" m√°s intuitivo
- Organizaci√≥n por funci√≥n, no por tipo de archivo

Es perfecto para:
- Aprender desarrollo de frameworks
- Proyectos educativos
- Aplicaciones peque√±as a medianas
- Base para frameworks m√°s complejos
- Entender arquitectura de frameworks modernos

**¬°Framework PHP MVC completo con estructura innovadora y simple!** üöÄ

POR FAVOR, implementa este framework completo siguiendo estas especificaciones exactas con la nueva estructura. Comienza con la estructura b√°sica y el sistema de rutas.

================================================================================
                            FIN DEL DOCUMENTO V2
================================================================================